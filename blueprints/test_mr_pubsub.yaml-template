tosca_definitions_version: cloudify_dsl_1_3

imports:
    - http://www.getcloudify.org/spec/cloudify/3.4/types.yaml
    - {{ ONAPTEMPLATE_RAWREPOURL_org_onap_dcaegen2_platform_plugins_releases }}/k8splugin/1.4.13/k8splugin_types.yaml
    - https://nexus.onap.org/service/local/repositories/raw/content/org.onap.ccsdk.platform.plugins/type_files/dmaap/dmaap.yaml

node_templates:

    topic00:
        type: ccsdk.nodes.Topic
        properties:
            topic_name: topic00

    topic01:
        type: ccsdk.nodes.Topic
        properties:
            topic_name: topic01

    web_server:
        type: dcae.nodes.ContainerizedServiceComponentUsingDmaap

        properties:
            service_component_type: 'nginx-web'
            image: nginx
            docker_config:
                healthcheck:
                    type: "http"
                    endpoint: "/"
            streams_publishes:
              - name: topic00
                location: san-francisco
                client_role: org.onap.dcae.pnfPublisher
                type: message_router
            streams_subscribes:
              - name: topic01
                location: san-francisco
                client_role: org.onap.dcae.pnfSubscriber
                type: message_router

        relationships:
            - type: ccsdk.relationships.publish_events
              target: topic00
            - type: ccsdk.relationships.subscribe_to_events
              target: topic01

        interfaces:
          cloudify.interfaces.lifecycle:
            start:
              inputs:
                ports:
                  - '80:0'
outputs:

    topic00_data:
        description: "Topic 00 data on client00"
        value: { get_attribute: [web_server, topic00]}

    topic01_data:
        description: "Topic 01 data on client00"
        value: { get_attribute: [web_server, topic01]}

